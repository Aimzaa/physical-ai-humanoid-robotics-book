"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics_book=globalThis.webpackChunkphysical_ai_humanoid_robotics_book||[]).push([[521],{5597:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"module-1-robotic-nervous-system/chapter-1-4-python-rclpy-programming","title":"Python rclpy Programming","description":"Goal","source":"@site/docs/module-1-robotic-nervous-system/chapter-1-4-python-rclpy-programming.md","sourceDirName":"module-1-robotic-nervous-system","slug":"/module-1-robotic-nervous-system/chapter-1-4-python-rclpy-programming","permalink":"/physical-ai-humanoid-robotics-book/docs/module-1-robotic-nervous-system/chapter-1-4-python-rclpy-programming","draft":false,"unlisted":false,"editUrl":"https://github.com/your-org/physical-ai-humanoid-robotics-book/tree/main/docs/module-1-robotic-nervous-system/chapter-1-4-python-rclpy-programming.md","tags":[],"version":"current","frontMatter":{"id":"chapter-1-4-python-rclpy-programming","title":"Python rclpy Programming","sidebar_label":"Python rclpy Programming"},"sidebar":"book","previous":{"title":"URDF for Humanoid Robots","permalink":"/physical-ai-humanoid-robotics-book/docs/module-1-robotic-nervous-system/chapter-1-3-urdf-humanoid-robots"},"next":{"title":"Launch Files and Parameters","permalink":"/physical-ai-humanoid-robotics-book/docs/module-1-robotic-nervous-system/chapter-1-5-launch-files-parameters"}}');var o=r(4848),s=r(8453);const l={id:"chapter-1-4-python-rclpy-programming",title:"Python rclpy Programming",sidebar_label:"Python rclpy Programming"},t="Python rclpy Programming",c={},a=[{value:"Goal",id:"goal",level:2},{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Overview",id:"overview",level:2},{value:"Key Concepts",id:"key-concepts",level:2},{value:"Step-by-Step Breakdown",id:"step-by-step-breakdown",level:2},{value:"Code Examples",id:"code-examples",level:2},{value:"Diagrams",id:"diagrams",level:2},{value:"Case Study",id:"case-study",level:2},{value:"References",id:"references",level:2},{value:"Review Questions",id:"review-questions",level:2},{value:"Practical Exercises",id:"practical-exercises",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"python-rclpy-programming",children:"Python rclpy Programming"})}),"\n",(0,o.jsx)(n.h2,{id:"goal",children:"Goal"}),"\n",(0,o.jsx)(n.p,{children:"Master the rclpy library for creating ROS 2 nodes in Python, focusing on best practices for humanoid robot applications."}),"\n",(0,o.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Create ROS 2 nodes using rclpy library"}),"\n",(0,o.jsx)(n.li,{children:"Implement publishers, subscribers, services, and actions in Python"}),"\n",(0,o.jsx)(n.li,{children:"Understand the ROS 2 execution model and event handling"}),"\n",(0,o.jsx)(n.li,{children:"Apply Python-specific patterns for efficient ROS 2 programming"}),"\n",(0,o.jsx)(n.li,{children:"Debug and test rclpy nodes effectively"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(n.p,{children:"rclpy is the Python client library for ROS 2, providing a Python API for creating ROS 2 nodes and communicating with other nodes. For humanoid robotics applications, Python is often used for high-level control, perception processing, and AI algorithms due to its rich ecosystem of libraries. Understanding rclpy is essential for implementing robot behaviors and integrating with other ROS 2 components."}),"\n",(0,o.jsx)(n.h2,{id:"key-concepts",children:"Key Concepts"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"rclpy"}),": The Python client library for ROS 2"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Node"}),": The basic execution unit in ROS 2"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Executor"}),": Manages the execution of nodes and callbacks"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"QoS (Quality of Service)"}),": Policies for message delivery and reliability"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Timers"}),": Mechanism for executing code at regular intervals"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Callbacks"}),": Functions executed when messages are received or services are called"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"step-by-step-breakdown",children:"Step-by-Step Breakdown"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Setting up rclpy"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Import rclpy and initialize"}),"\n",(0,o.jsx)(n.li,{children:"Create a node class inheriting from rclpy.node.Node"}),"\n",(0,o.jsx)(n.li,{children:"Implement proper cleanup with destroy_node()"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Creating Publishers"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Use create_publisher() to create message publishers"}),"\n",(0,o.jsx)(n.li,{children:"Define appropriate QoS profiles"}),"\n",(0,o.jsx)(n.li,{children:"Publish messages at desired rates"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Creating Subscribers"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Use create_subscription() to receive messages"}),"\n",(0,o.jsx)(n.li,{children:"Handle different message types"}),"\n",(0,o.jsx)(n.li,{children:"Implement appropriate QoS settings"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Implementing Services"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Create service servers with create_service()"}),"\n",(0,o.jsx)(n.li,{children:"Define service request/response types"}),"\n",(0,o.jsx)(n.li,{children:"Handle service calls in callbacks"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Working with Actions"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Implement action clients and servers"}),"\n",(0,o.jsx)(n.li,{children:"Handle goals, feedback, and results"}),"\n",(0,o.jsx)(n.li,{children:"Manage long-running operations"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Execution Management"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Use SingleThreadedExecutor or MultiThreadedExecutor"}),"\n",(0,o.jsx)(n.li,{children:"Spin nodes to process callbacks"}),"\n",(0,o.jsx)(n.li,{children:"Handle async operations appropriately"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"code-examples",children:"Code Examples"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"# Complete example of a humanoid control node\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\nfrom sensor_msgs.msg import JointState\nfrom control_msgs.action import FollowJointTrajectory\nfrom rclpy.action import ActionClient\nfrom rclpy.qos import QoSProfile, QoSDurabilityPolicy\n\nclass HumanoidController(Node):\n    def __init__(self):\n        super().__init__('humanoid_controller')\n\n        # Create a publisher for joint commands\n        qos_profile = QoSProfile(depth=10)\n        qos_profile.durability = QoSDurabilityPolicy.TRANSIENT_LOCAL\n        self.joint_pub = self.create_publisher(JointState, '/joint_commands', qos_profile)\n\n        # Create a subscriber for sensor data\n        self.sensor_sub = self.create_subscription(\n            JointState,\n            '/joint_states',\n            self.joint_state_callback,\n            10\n        )\n\n        # Create a timer for periodic control updates\n        self.timer = self.create_timer(0.05, self.control_loop)  # 20Hz control loop\n\n        # Create an action client for trajectory execution\n        self.trajectory_client = ActionClient(\n            self,\n            FollowJointTrajectory,\n            'follow_joint_trajectory'\n        )\n\n        self.get_logger().info('Humanoid Controller initialized')\n\n    def joint_state_callback(self, msg):\n        \"\"\"Callback for processing joint state messages\"\"\"\n        self.get_logger().info(f'Received joint states for {len(msg.name)} joints')\n        # Process sensor data for control algorithms\n\n    def control_loop(self):\n        \"\"\"Main control loop executed at 20Hz\"\"\"\n        # Implement control algorithm here\n        cmd_msg = JointState()\n        cmd_msg.name = ['hip_joint', 'knee_joint', 'ankle_joint']\n        cmd_msg.position = [0.1, 0.2, 0.3]  # Example positions\n\n        self.joint_pub.publish(cmd_msg)\n\n    def send_trajectory_goal(self, trajectory):\n        \"\"\"Send a trajectory goal to the action server\"\"\"\n        goal_msg = FollowJointTrajectory.Goal()\n        goal_msg.trajectory = trajectory\n\n        self.trajectory_client.wait_for_server()\n        self.trajectory_client.send_goal_async(goal_msg)\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    controller = HumanoidController()\n\n    try:\n        rclpy.spin(controller)\n    except KeyboardInterrupt:\n        controller.get_logger().info('Interrupted by user')\n    finally:\n        controller.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,o.jsx)(n.h2,{id:"diagrams",children:"Diagrams"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"rclpy Execution Model:\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Publisher     \u2502    \u2502   Subscriber    \u2502    \u2502   Service/Action\u2502\n\u2502   Callbacks     \u2502    \u2502   Callbacks     \u2502    \u2502   Callbacks     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502                      \u2502                      \u2502\n          \u2502                      \u2502                      \u2502\n          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                 \u2502\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502     Executor            \u2502\n                    \u2502  (Single/Multi-threaded)\u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                 \u2502\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502   Node Event Loop       \u2502\n                    \u2502   (rclpy.spin())        \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,o.jsx)(n.h2,{id:"case-study",children:"Case Study"}),"\n",(0,o.jsx)(n.p,{children:"In humanoid robotics, rclpy nodes are often used for high-level behaviors such as walking pattern generation, balance control, and perception processing. For example, a Python node might process camera images using OpenCV to detect obstacles, then publish this information to a navigation system. The asynchronous nature of rclpy allows the node to handle multiple sensor streams and respond to events in real-time."}),"\n",(0,o.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://docs.ros.org/en/humble/p/rclpy/",children:"rclpy Documentation"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Creating-Your-First-ROS2-Package.html",children:"ROS 2 Python Tutorials"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Concepts/About-Quality-of-Service-Settings.html",children:"Quality of Service in ROS 2"})}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"review-questions",children:"Review Questions"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"What is the role of the executor in rclpy?"}),"\n",(0,o.jsx)(n.li,{children:"Explain the difference between SingleThreadedExecutor and MultiThreadedExecutor."}),"\n",(0,o.jsx)(n.li,{children:"How do you properly handle cleanup when shutting down an rclpy node?"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"practical-exercises",children:"Practical Exercises"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Create a simple rclpy node that publishes a counter value every second"}),"\n",(0,o.jsx)(n.li,{children:"Create a subscriber node that receives and logs the counter values"}),"\n",(0,o.jsx)(n.li,{children:"Implement a service server that calculates the factorial of a number"}),"\n",(0,o.jsx)(n.li,{children:"Create a node with a timer that executes a control loop at 100Hz"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>t});var i=r(6540);const o={},s=i.createContext(o);function l(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);